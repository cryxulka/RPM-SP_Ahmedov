#include <iostream>
#include <forward_list>
#include <list>
#include <random>
#include <chrono>
#include <clocale>
#include <fstream>

using namespace std;

const int N = 1000000;
const int RANGE = 1001;

void fill_forward_list(forward_list<int>& fl, mt19937& gen) {
    fl.clear();
    uniform_int_distribution<> dis(0, RANGE - 1);
    for (int i = 0; i < N; ++i)
        fl.push_front(dis(gen));
}

void fill_list(list<int>& l, mt19937& gen) {
    l.clear();
    uniform_int_distribution<> dis(0, RANGE - 1);
    for (int i = 0; i < N; ++i)
        l.push_back(dis(gen));
}

int main() {
    setlocale(LC_ALL, "Russian");

    mt19937 gen(12345);

    forward_list<int> fl;
    list<int> l;

    fill_forward_list(fl, gen);
    fill_list(l, gen);

    const int REPEATS = 1000;

    auto start = chrono::high_resolution_clock::now();
    auto end = chrono::high_resolution_clock::now();

    start = chrono::high_resolution_clock::now();
    for (int i = 0; i < REPEATS; ++i) fl.push_front(42);
    end = chrono::high_resolution_clock::now();
    double fl_push_front = chrono::duration_cast<chrono::duration<double, micro>>(end - start).count() / REPEATS;

    start = chrono::high_resolution_clock::now();
    for (int i = 0; i < REPEATS; ++i) fl.pop_front();
    end = chrono::high_resolution_clock::now();
    double fl_pop_front = chrono::duration_cast<chrono::duration<double, micro>>(end - start).count() / REPEATS;

    start = chrono::high_resolution_clock::now();
    for (int i = 0; i < REPEATS; ++i) l.push_front(42);
    end = chrono::high_resolution_clock::now();
    double l_push_front = chrono::duration_cast<chrono::duration<double, micro>>(end - start).count() / REPEATS;

    start = chrono::high_resolution_clock::now();
    for (int i = 0; i < REPEATS; ++i) l.pop_front();
    end = chrono::high_resolution_clock::now();
    double l_pop_front = chrono::duration_cast<chrono::duration<double, micro>>(end - start).count() / REPEATS;

    start = chrono::high_resolution_clock::now();
    for (int i = 0; i < REPEATS; ++i) l.push_back(42);
    end = chrono::high_resolution_clock::now();
    double l_push_back = chrono::duration_cast<chrono::duration<double, micro>>(end - start).count() / REPEATS;

    start = chrono::high_resolution_clock::now();
    for (int i = 0; i < REPEATS; ++i) l.pop_back();
    end = chrono::high_resolution_clock::now();
    double l_pop_back = chrono::duration_cast<chrono::duration<double, micro>>(end - start).count() / REPEATS;

    ofstream file("results.csv");
    file.imbue(locale("C"));
    file << "Операция;forward_list;list\n";
    file << "Вставка в начало;" << fl_push_front << ";" << l_push_front << "\n";
    file << "Удаление первого;" << fl_pop_front << ";" << l_pop_front << "\n";
    file << "Вставка в конец;-;" << l_push_back << "\n";
    file << "Удаление последнего;-;" << l_pop_back << "\n";
    file.close();

    cout << "Результаты сохранены в файл results.csv\n";
    cout << "Откройте его в Excel для просмотра и построения графика.\n";

    return 0;
}